# HTML2exe Build & Release - Windows Fresh VM\r\n# Run as Administrator for NSIS installation\r\n\r\n# 0) Install prerequisites\r\nWrite-Host "Installing prerequisites..." -ForegroundColor Green\r\nchoco install python --version=3.11.6 -y\r\nchoco install nsis -y\r\nchoco install git -y\r\nrefreshenv\r\n\r\n# 1) Clone and setup\r\nWrite-Host "Setting up repository..." -ForegroundColor Green\r\ngit clone <YOUR_REPO_URL> html2exe\r\ncd html2exe\r\n\r\n# 2) Python environment\r\nWrite-Host "Creating Python environment..." -ForegroundColor Green\r\npython -m venv .venv\r\n.\\.venv\\Scripts\\Activate.ps1\r\npython -m pip install --upgrade pip\r\n\r\n# 3) Install package in development mode\r\nWrite-Host "Installing HTML2exe..." -ForegroundColor Green\r\npip install -e ".[dev]"\r\n\r\n# 4) Run quality checks\r\nWrite-Host "Running quality checks..." -ForegroundColor Green\r\nmake format\r\nmake lint  \r\nmake typecheck\r\nmake test\r\n\r\n# 5) Create example HTML for testing\r\nWrite-Host "Creating test HTML..." -ForegroundColor Green\r\nmkdir examples -ErrorAction SilentlyContinue\r\n@"\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n    <title>HTML2exe Example</title>\r\n    <style>\r\n        body { font-family: Arial; margin: 40px; background: linear-gradient(45deg, #667eea, #764ba2); color: white; text-align: center; }\r\n        h1 { font-size: 2.5em; margin-bottom: 20px; }\r\n        p { font-size: 1.2em; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <h1>HTML2exe Works!</h1>\r\n    <p>This HTML has been converted to a Windows executable.</p>\r\n    <script>\r\n        console.log('HTML2exe example loaded successfully!');\r\n        setTimeout(() => alert('Welcome to HTML2exe!'), 1000);\r\n    </script>\r\n</body>\r\n</html>\r\n"@ | Out-File -FilePath "examples\\demo.html" -Encoding UTF8\r\n\r\n# 6) Test CLI conversion (check mode)\r\nWrite-Host "Testing conversion..." -ForegroundColor Green\r\nhtml2exe --input examples\\demo.html --output dist\\Demo.exe --check --verbose\r\n\r\n# 7) Build actual EXE\r\nWrite-Host "Building HTML2exe.exe..." -ForegroundColor Green\r\nmake build\r\n\r\n# 8) Verify EXE was created\r\nif (!(Test-Path "dist\\HTML2exe.exe")) {\r\n    throw "HTML2exe.exe was not created"\r\n}\r\n$exeSize = (Get-Item "dist\\HTML2exe.exe").Length\r\nWrite-Host "âœ“ HTML2exe.exe created successfully ($([math]::Round($exeSize/1MB, 2)) MB)" -ForegroundColor Green\r\n\r\n# 9) Build NSIS installer\r\nWrite-Host "Building installer..." -ForegroundColor Green\r\nmake dist\r\n\r\n# 10) Verify installer was created  \r\nif (!(Test-Path "dist\\HTML2exe-Setup-1.0.0.exe")) {\r\n    throw "Installer was not created"\r\n}\r\n$installerSize = (Get-Item "dist\\HTML2exe-Setup-1.0.0.exe").Length\r\nWrite-Host "âœ“ Installer created successfully ($([math]::Round($installerSize/1MB, 2)) MB)" -ForegroundColor Green\r\n\r\n# 11) Test installation (silent mode for CI)\r\nWrite-Host "Testing installation..." -ForegroundColor Green\r\nStart-Process -FilePath "dist\\HTML2exe-Setup-1.0.0.exe" -ArgumentList "/S" -Wait\r\n\r\n# 12) Verify installation\r\n$installedExe = "C:\\Program Files\\HTML2exe\\HTML2exe.exe"\r\nif (Test-Path $installedExe) {\r\n    Write-Host "âœ“ Installation successful" -ForegroundColor Green\r\n    \r\n    # Test installed version\r\n    $version = & $installedExe --version 2>$null\r\n    Write-Host "âœ“ Installed version: $version" -ForegroundColor Green\r\n} else {\r\n    Write-Warning "Installation verification failed"\r\n}\r\n\r\n# Optional: Sign files (requires certificates)\r\n# Write-Host "Code signing (optional)..." -ForegroundColor Yellow\r\n# if ($env:SIGN_CERT -and $env:SIGN_PASS) {\r\n#     $cert = [System.Convert]::FromBase64String($env:SIGN_CERT)\r\n#     [System.IO.File]::WriteAllBytes("temp_cert.pfx", $cert)\r\n#     signtool sign /f "temp_cert.pfx" /p $env:SIGN_PASS /tr "http://timestamp.digicert.com" /td sha256 /fd sha256 "dist\\HTML2exe.exe"\r\n#     signtool sign /f "temp_cert.pfx" /p $env:SIGN_PASS /tr "http://timestamp.digicert.com" /td sha256 /fd sha256 "dist\\HTML2exe-Setup-1.0.0.exe" \r\n#     Remove-Item "temp_cert.pfx"\r\n#     Write-Host "âœ“ Files signed successfully" -ForegroundColor Green\r\n# }\r\n\r\nWrite-Host "`nðŸŽ‰ Build completed successfully!" -ForegroundColor Green\r\nWrite-Host "Files created:" -ForegroundColor Cyan\r\nWrite-Host "  - dist\\HTML2exe.exe (application)" -ForegroundColor White\r\nWrite-Host "  - dist\\HTML2exe-Setup-1.0.0.exe (installer)" -ForegroundColor White
